<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雀神遗珍 (Mahjong Legacy)</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 首页 -->
    <div id="start-screen" class="screen active">
        <!-- 认证与个人中心模块 -->
        <div id="auth-layer" class="auth-layer">
            <!-- 登录/注册表单 -->
            <div id="auth-container" class="auth-box">
                <h3>档案同步</h3>
                <input type="text" id="nickname-input" placeholder="昵称" />
                <input type="password" id="password-input" placeholder="密码" />
                <div class="auth-btns">
                    <button id="login-btn" class="secondary-btn">登录</button>
                    <button id="register-btn" class="secondary-btn">注册</button>
                </div>
                <p id="auth-msg" class="message"></p>
            </div>

            <!-- 个人信息面板 -->
            <div id="profile-container" class="auth-box" style="display: none;">
                <h3>雀神档案</h3>
                <div class="user-info">
                    <span class="user-nickname" id="user-nickname-display"></span>
                    <span class="user-email" id="user-email" style="display:none;"></span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="label">游玩次数</span>
                        <span class="value" id="stat-play-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">通关次数</span>
                        <span class="value" id="stat-clear-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">最高得分</span>
                        <span class="value" id="stat-high-score">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">活跃天数</span>
                        <span class="value" id="stat-total-days">0</span>
                    </div>
                </div>
                
                <div class="profile-actions">
                    <button id="change-nickname-btn" class="action-btn">改名</button>
                    <button id="change-password-btn" class="action-btn">改密</button>
                    <button id="logout-btn" class="secondary-btn logout">注销</button>
                </div>
            </div>
        </div>

        <div class="start-content">
            <h1 class="game-title">雀神遗珍</h1>
            <h2 class="game-subtitle">Mahjong Legacy</h2>
            <button id="start-game-btn" class="main-btn">开始游戏</button>
        </div>
    </div>

    <!-- 游戏主界面 -->
    <div id="game-screen" class="game-container screen">
        <div class="main-layout">
            <div class="left-panel">
                <h1>雀神遗珍 <span class="subtitle">Mahjong Legacy</span></h1>
                
                <!-- 关卡信息栏 -->
                <div class="level-bar">
                    <div class="level-info">
                        <span class="label">关卡</span>
                        <span class="value" id="current-round">1</span>
                    </div>
                    <div class="score-target">
                        <div class="score-progress">
                            <span class="label">当前分数:</span>
                            <span class="value" id="round-score">0</span>
                        </div>
                        <div class="progress-separator">/</div>
                        <div class="score-goal">
                            <span class="label">目标分数:</span>
                            <span class="value" id="target-score">150</span>
                        </div>
                    </div>
                    <div class="action-counts">
                        <div class="count-box blue">
                            <span class="label">出牌</span>
                            <span class="value" id="hands-count">3</span>
                        </div>
                        <div class="count-box red">
                            <span class="label">换牌</span>
                            <span class="value" id="discards-count">3</span>
                        </div>
                    </div>
                </div>

                <!-- Buff 展示栏 -->
                <div class="buff-container" id="active-buffs">
                    <!-- Buff 图标将在这里动态生成 -->
                    <div class="buff-slot empty">空</div>
                    <div class="buff-slot empty">空</div>
                    <div class="buff-slot empty">空</div>
                    <div class="buff-slot empty">空</div>
                    <div class="buff-slot empty">空</div>
                </div>

                <!-- 计分板 -->
                <div class="score-board">
                    <div class="score-box chips">
                        <div class="label">筹码</div>
                        <div class="value" id="chips-value">0</div>
                    </div>
                    <div class="x-sign">X</div>
                    <div class="score-box mult">
                        <div class="label">倍率</div>
                        <div class="value" id="mult-value">0</div>
                    </div>
                    <div class="equals-sign">=</div>
                    <div class="score-box total">
                        <div class="label">本手得分</div>
                        <div class="value" id="hand-score">0</div>
                    </div>
                </div>

                <div class="hand-container" id="hand-container">
                    <!-- 手牌将通过 JS 生成 -->
                </div>

                <div class="controls">
                    <button id="exchange-btn">出牌 (Play)</button>
                    <button id="check-btn">和牌 (Win)</button>
                    <button id="refresh-btn" style="display: none;">刷新手牌</button>
                    <button id="deck-view-btn">剩余牌堆</button>
                    <button id="view-yaku-btn" class="secondary-btn">查看番型</button>
                    <button id="reset-btn" style="display: none;">重置游戏</button> <!-- 隐藏旧的重置按钮 -->
                </div>

                <div class="result-panel">
                    <h3>触发牌型 (Yaku)</h3>
                    <div id="yaku-list" class="yaku-list"></div>
                </div>
            </div>

            <div class="right-panel">
                <div class="info-panel">
                    <h3>游戏规则</h3>
                    <p>1. 凑出胡牌牌型得分最高</p>
                    <p>2. 核心番种：断幺九、对对胡、清一色、七对子等</p>
                    <p>3. 达到目标分数即可过关</p>
                    <p>4. 每次过关可在商店购买 雀灵</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 商店模态框 -->
    <div id="shop-modal" class="modal">
        <div class="modal-content shop-content">
            <h2>商店 - 选择一个 雀灵</h2>
            <div class="shop-cards" id="shop-cards">
                <!-- 商店卡片通过 JS 生成 -->
            </div>
            <div class="modal-footer">
                <button id="skip-shop-btn" class="secondary-btn">跳过</button>
            </div>
        </div>
    </div>

    <!-- 牌堆预览模态框 -->
    <div id="deck-modal" class="modal">
        <div class="modal-content">
            <div class="deck-info">
                <h3>剩余牌堆: <span id="deck-count">0</span></h3>
                <div id="deck-preview" class="deck-preview">
                    <!-- 牌堆预览 -->
                </div>
                <div class="modal-footer">
                    <button id="close-deck-btn" class="close-btn-large">退出预览</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 番型查看模态框 -->
    <div id="yaku-modal" class="modal">
        <div class="modal-content">
            <h2>番型一览</h2>
            <div class="yaku-table-container">
                <table class="yaku-table">
                    <thead>
                        <tr>
                            <th>名称</th>
                            <th>筹码</th>
                            <th>倍率</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody id="yaku-table-body">
                        <!-- JS 填充 -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button id="close-yaku-btn" class="secondary-btn">关闭</button>
            </div>
        </div>
    </div>

    <!-- 游戏结束/胜利模态框 -->
    <div id="game-over-modal" class="modal">
        <div class="modal-content small-modal">
            <h2 id="game-over-title">游戏结束</h2>
            <p id="game-over-message">你的得分未达到目标。</p>
            <button id="restart-btn" class="main-btn">重新开始</button>
        </div>
    </div>

    <!-- 排行榜模态框 -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content">
            <h2>🏆 雀神排行榜</h2>
            <div class="leaderboard-list" id="leaderboard-list">
                <p>加载中...</p>
            </div>
            <div class="modal-footer">
                <button id="close-leaderboard-btn" class="secondary-btn">关闭</button>
            </div>
        </div>
    </div>

    <!-- 每日奖励模态框 -->
    <div id="daily-reward-modal" class="modal">
        <div class="modal-content small-modal">
            <h2 style="color: #f1c40f;">🎁 每日登录奖励</h2>
            <p id="daily-reward-msg">获得：初始筹码 +100</p>
            <button id="claim-reward-btn" class="main-btn">领取</button>
        </div>
    </div>

    <!-- 修改昵称模态框 -->
    <div id="nickname-modal" class="modal">
        <div class="modal-content small-modal">
            <h3>修改昵称</h3>
            <input type="text" id="new-nickname-input" placeholder="新昵称">
            <p class="hint" style="font-size: 0.8em; color: #888;">每7天可修改一次</p>
            <div class="modal-footer">
                <button id="confirm-nickname-btn" class="main-btn">确认</button>
                <button id="cancel-nickname-btn" class="secondary-btn">取消</button>
            </div>
        </div>
    </div>

    <!-- 修改密码模态框 -->
    <div id="password-modal" class="modal">
        <div class="modal-content small-modal">
            <h3>修改密码</h3>
            <input type="password" id="new-password-input" placeholder="新密码">
            <div class="modal-footer">
                <button id="confirm-password-btn" class="main-btn">确认</button>
                <button id="cancel-password-btn" class="secondary-btn">取消</button>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="game.js"></script>
</body>
</html>